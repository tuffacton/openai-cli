template:
  name: OpenAI Completion
  type: Step
  projectIdentifier: Nic_Sandbox
  orgIdentifier: SE_Sandbox
  spec:
    type: Container
    spec:
      connectorRef: Nics_Registry
      image: tuffacton/openaicli:latest
      command: |-
        ########################
        # OpenAI GPT Completion
        ########################
        # Either provide a prompt as a runtime input or 
        # replace it below in the RESPONSE output variable
        #
        # Must configure OPENAI_API_KEY your OpenAI PAT
        # Uses https://github.com/tuffacton/openai-cli
        #########################
        export RESPONSE=`/openai $PROMPT`
      shell: Bash
      infrastructure:
        type: KubernetesDirect
        spec:
          connectorRef: nic_laptop_cluster
          namespace: build
          resources:
            limits:
              cpu: "0.5"
              memory: 500Mi
          annotations: {}
          labels: {}
          containerSecurityContext:
            capabilities:
              drop: []
              add: []
          nodeSelector: {}
          os: Linux
      outputVariables:
        - name: RESPONSE
      envVariables:
        OPENAI_API_KEY: <+secrets.getValue("OpenAI_PAT")>
        PROMPT: <+input>
    timeout: 2m
  identifier: OpenAI_Completion
  versionLabel: 0.1.0
